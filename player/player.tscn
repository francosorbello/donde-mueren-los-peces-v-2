[gd_scene load_steps=40 format=3 uid="uid://4ybnmc4j2y3v"]

[ext_resource type="Texture2D" uid="uid://c1igxf8ox4vds" path="res://assets/GRAPHICS/spaceman.png" id="1_oul6g"]
[ext_resource type="Script" uid="uid://caxec55tunhge" path="res://player/player.gd" id="1_rkbax"]
[ext_resource type="AudioStream" uid="uid://dgadymra1s2ay" path="res://assets/SOUNDS/pretty_footsetp.mp3" id="3_g1dw6"]
[ext_resource type="Script" uid="uid://8dv7dce6ncjv" path="res://addons/ftr_tools/sm/state_machine.gd" id="4_yw30f"]
[ext_resource type="Script" uid="uid://bijnqy4wt580s" path="res://player/states/idle_state.gd" id="5_qjkh3"]
[ext_resource type="Script" uid="uid://c55rmvk4p4wdj" path="res://player/states/moving_state.gd" id="6_g6k8r"]
[ext_resource type="Script" uid="uid://cjq2op1qwxb62" path="res://player/states/shooting_bubble_state.gd" id="7_boad6"]
[ext_resource type="Script" uid="uid://cpqtb5ob20158" path="res://player/states/dashing_state.gd" id="8_8t03j"]
[ext_resource type="PackedScene" uid="uid://46qyrbx34yuv" path="res://bubble/bubble_indicator.tscn" id="8_rgyib"]
[ext_resource type="Script" uid="uid://cdl66dyxa8q0e" path="res://player/states/jumping_state.gd" id="12_32hag"]
[ext_resource type="AudioStream" uid="uid://bvlcode311dss" path="res://assets/SOUNDS/dash.ogg" id="12_e7oew"]
[ext_resource type="AudioStream" uid="uid://clphpvymjfvrs" path="res://assets/SOUNDS/104948__glaneur-de-sons__bubble-9.mp3" id="13_c35mf"]
[ext_resource type="Script" uid="uid://csx632fp1ai83" path="res://player/states/quick_dashing_state.gd" id="13_tqiix"]
[ext_resource type="AudioStream" uid="uid://b8q2ul5salv6o" path="res://assets/SOUNDS/337132__cdonahueucsd__bubble_small.mp3" id="14_65viv"]
[ext_resource type="PackedScene" uid="uid://nk1aatfajmy" path="res://interactables/better_interactable_manager.tscn" id="14_kb6p2"]
[ext_resource type="Texture2D" uid="uid://dn14b2si6osly" path="res://assets/GRAPHICS/Bubble/bubble.png" id="15_wodsf"]
[ext_resource type="Script" uid="uid://cqprkqpkvmaxw" path="res://player/states/on_air_current_state.gd" id="17_7pqkx"]
[ext_resource type="Script" uid="uid://dinmes2qht02b" path="res://player/empty_state.gd" id="18_rptt4"]
[ext_resource type="PackedScene" uid="uid://bk7iuu4nm3sej" path="res://player/dead_anim_player.tscn" id="22_bjvpn"]
[ext_resource type="Script" uid="uid://js1b4vcldlwv" path="res://abilities/explosion_ability.gd" id="22_s7qer"]
[ext_resource type="PackedScene" uid="uid://c1kriosoqfogr" path="res://bubble/explosion_area_visual.tscn" id="24_g4c7l"]
[ext_resource type="PackedScene" uid="uid://dem7nplrep8ee" path="res://hurt_and_hit_boxes/hurtbox.tscn" id="24_knn7v"]
[ext_resource type="AudioStream" uid="uid://cb8rkyh42ljde" path="res://assets/SOUNDS/explosion5.mp3" id="25_knn7v"]
[ext_resource type="Script" uid="uid://dsqa6qt0p6jf" path="res://player/spawn_point_manager.gd" id="26_7pqkx"]
[ext_resource type="Script" uid="uid://dn48vjrdhx4i" path="res://player/floor_detection/floor_detection_component.gd" id="26_uw77l"]
[ext_resource type="PackedScene" uid="uid://cmg6s3pb44xmv" path="res://inventory_system/carryable_item/item_follower_manager.tscn" id="27_rptt4"]
[ext_resource type="PackedScene" uid="uid://bjka4rd2o0w7v" path="res://player/floor_detection/floor_detector.tscn" id="27_uw77l"]

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_65viv"]
radius = 4.0
height = 12.0

[sub_resource type="Animation" id="Animation_g1dw6"]
length = 0.001
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("BubbleSprite:visible")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 1,
"values": [false]
}
tracks/2/type = "value"
tracks/2/imported = false
tracks/2/enabled = true
tracks/2/path = NodePath("BubbleSprite:scale")
tracks/2/interp = 1
tracks/2/loop_wrap = true
tracks/2/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [Vector2(1e-05, 1e-05)]
}

[sub_resource type="Animation" id="Animation_yw30f"]
resource_name = "idle"
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0),
"transitions": PackedFloat32Array(1),
"update": 0,
"values": [0.0]
}

[sub_resource type="Animation" id="Animation_rkbax"]
resource_name = "move"
length = 0.45
loop_mode = 1
step = 0.05
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:rotation")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3),
"transitions": PackedFloat32Array(1, 1, 1),
"update": 0,
"values": [-0.08726646259971647, 0.0, 0.08726646259971647]
}
tracks/1/type = "method"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("StepSounds")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.15, 0.3),
"transitions": PackedFloat32Array(1, 1, 1),
"values": [{
"args": [0.0],
"method": &"play"
}, {
"args": [0.0],
"method": &"play"
}, {
"args": [0.0],
"method": &"play"
}]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_qjkh3"]
_data = {
&"RESET": SubResource("Animation_g1dw6"),
&"idle": SubResource("Animation_yw30f"),
&"move": SubResource("Animation_rkbax")
}

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_yw30f"]
random_pitch = 1.3
streams_count = 1
stream_0/stream = ExtResource("3_g1dw6")

[sub_resource type="Curve" id="Curve_yllr7"]
_data = [Vector2(0, 1), 0.0, 0.0, 0, 0, Vector2(0.98986477, 0), -2.256791, 0.0, 0, 0]
point_count = 2

[sub_resource type="Curve" id="Curve_e7oew"]
_limits = [1.0, 5.0, 0.0, 1.0]
_data = [Vector2(0, 2.2), 0.0, 0.0, 0, 0, Vector2(1, 1), 0.0, 0.0, 0, 0]
point_count = 2
metadata/_snap_enabled = true

[sub_resource type="AudioStreamRandomizer" id="AudioStreamRandomizer_e7oew"]
random_pitch = 1.3
streams_count = 1
stream_0/stream = ExtResource("12_e7oew")

[sub_resource type="Curve2D" id="Curve2D_rgyib"]
_data = {
"points": PackedVector2Array(0, 0, 0, 0, 10, 0, 0, 0, 0, 0, 9.921762, 0.6242244, 0, 0, 0, 0, 9.69533, 1.2248049, 0, 0, 0, 0, 9.343111, 1.7822937, 0, 0, 0, 0, 8.895673, 2.2840207, 0, 0, 0, 0, 8.385052, 2.7244685, 0, 0, 0, 0, 7.839736, 3.103971, 0, 0, 0, 0, 7.282174, 3.426731, 0, 0, 0, 0, 6.728371, 3.6989534, 0, 0, 0, 0, 6.188699, 3.9274676, 0, 0, 0, 0, 5.6691527, 4.1188807, 0, 0, 0, 0, 5.1725955, 4.279143, 0, 0, 0, 0, 4.699783, 4.4133897, 0, 0, 0, 0, 4.250136, 4.5259347, 0, 0, 0, 0, 3.8222783, 4.620341, 0, 0, 0, 0, 3.4143996, 4.6995177, 0, 0, 0, 0, 3.0244865, 4.7658286, 0, 0, 0, 0, 2.650465, 4.821178, 0, 0, 0, 0, 2.290283, 4.867099, 0, 0, 0, 0, 1.9419534, 4.9048142, 0, 0, 0, 0, 1.6035745, 4.935295, 0, 0, 0, 0, 1.2733318, 4.9593, 0, 0, 0, 0, 0.94949186, 4.977411, 0, 0, 0, 0, 0.6303906, 4.990055, 0, 0, 0, 0, 0.3144178, 4.997528, 0, 0, 0, 0, 3.061516e-16, 5, 0, 0, 0, 0, -0.3144178, 4.997528, 0, 0, 0, 0, -0.6303906, 4.990055, 0, 0, 0, 0, -0.94949186, 4.977411, 0, 0, 0, 0, -1.2733318, 4.9593, 0, 0, 0, 0, -1.6035745, 4.935295, 0, 0, 0, 0, -1.9419534, 4.9048142, 0, 0, 0, 0, -2.290283, 4.867099, 0, 0, 0, 0, -2.650465, 4.821178, 0, 0, 0, 0, -3.0244865, 4.7658286, 0, 0, 0, 0, -3.4143996, 4.6995177, 0, 0, 0, 0, -3.8222783, 4.620341, 0, 0, 0, 0, -4.250136, 4.5259347, 0, 0, 0, 0, -4.699783, 4.4133897, 0, 0, 0, 0, -5.1725955, 4.279143, 0, 0, 0, 0, -5.6691527, 4.1188807, 0, 0, 0, 0, -6.188699, 3.9274676, 0, 0, 0, 0, -6.728371, 3.6989534, 0, 0, 0, 0, -7.282174, 3.426731, 0, 0, 0, 0, -7.839736, 3.103971, 0, 0, 0, 0, -8.385052, 2.7244685, 0, 0, 0, 0, -8.895673, 2.2840207, 0, 0, 0, 0, -9.343111, 1.7822937, 0, 0, 0, 0, -9.69533, 1.2248049, 0, 0, 0, 0, -9.921762, 0.6242244, 0, 0, 0, 0, -10, 1.2246064e-15, 0, 0, 0, 0, -9.921762, -0.6242244, 0, 0, 0, 0, -9.69533, -1.2248049, 0, 0, 0, 0, -9.343111, -1.7822937, 0, 0, 0, 0, -8.895673, -2.2840207, 0, 0, 0, 0, -8.385052, -2.7244685, 0, 0, 0, 0, -7.839736, -3.103971, 0, 0, 0, 0, -7.282174, -3.426731, 0, 0, 0, 0, -6.728371, -3.6989534, 0, 0, 0, 0, -6.188699, -3.9274676, 0, 0, 0, 0, -5.6691527, -4.1188807, 0, 0, 0, 0, -5.1725955, -4.279143, 0, 0, 0, 0, -4.699783, -4.4133897, 0, 0, 0, 0, -4.250136, -4.5259347, 0, 0, 0, 0, -3.8222783, -4.620341, 0, 0, 0, 0, -3.4143996, -4.6995177, 0, 0, 0, 0, -3.0244865, -4.7658286, 0, 0, 0, 0, -2.650465, -4.821178, 0, 0, 0, 0, -2.290283, -4.867099, 0, 0, 0, 0, -1.9419534, -4.9048142, 0, 0, 0, 0, -1.6035745, -4.935295, 0, 0, 0, 0, -1.2733318, -4.9593, 0, 0, 0, 0, -0.94949186, -4.977411, 0, 0, 0, 0, -0.6303906, -4.990055, 0, 0, 0, 0, -0.3144178, -4.997528, 0, 0, 0, 0, -9.184548e-16, -5, 0, 0, 0, 0, 0.3144178, -4.997528, 0, 0, 0, 0, 0.6303906, -4.990055, 0, 0, 0, 0, 0.94949186, -4.977411, 0, 0, 0, 0, 1.2733318, -4.9593, 0, 0, 0, 0, 1.6035745, -4.935295, 0, 0, 0, 0, 1.9419534, -4.9048142, 0, 0, 0, 0, 2.290283, -4.867099, 0, 0, 0, 0, 2.650465, -4.821178, 0, 0, 0, 0, 3.0244865, -4.7658286, 0, 0, 0, 0, 3.4143996, -4.6995177, 0, 0, 0, 0, 3.8222783, -4.620341, 0, 0, 0, 0, 4.250136, -4.5259347, 0, 0, 0, 0, 4.699783, -4.4133897, 0, 0, 0, 0, 5.1725955, -4.279143, 0, 0, 0, 0, 5.6691527, -4.1188807, 0, 0, 0, 0, 6.188699, -3.9274676, 0, 0, 0, 0, 6.728371, -3.6989534, 0, 0, 0, 0, 7.282174, -3.426731, 0, 0, 0, 0, 7.839736, -3.103971, 0, 0, 0, 0, 8.385052, -2.7244685, 0, 0, 0, 0, 8.895673, -2.2840207, 0, 0, 0, 0, 9.343111, -1.7822937, 0, 0, 0, 0, 9.69533, -1.2248049, 0, 0, 0, 0, 9.921762, -0.6242244)
}
point_count = 100

[sub_resource type="CircleShape2D" id="CircleShape2D_g4c7l"]
radius = 12.0

[sub_resource type="RectangleShape2D" id="RectangleShape2D_uw77l"]
size = Vector2(12, 5)

[node name="Player" type="CharacterBody2D" groups=["player"]]
y_sort_enabled = true
motion_mode = 1
script = ExtResource("1_rkbax")
speed = 60.0
accel = 10.0
soften_color = Color(0.5251013, 0.5251013, 0.5251013, 0.6117647)

[node name="Sprite2D" type="Sprite2D" parent="."]
z_index = 1
position = Vector2(0, 6)
texture = ExtResource("1_oul6g")
offset = Vector2(0, -6)

[node name="SmallCollisionShape" type="CollisionShape2D" parent="."]
position = Vector2(0, 4)
rotation = 1.5707964
shape = SubResource("CapsuleShape2D_65viv")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
libraries = {
&"": SubResource("AnimationLibrary_qjkh3")
}

[node name="StepSounds" type="AudioStreamPlayer" parent="."]
stream = SubResource("AudioStreamRandomizer_yw30f")
volume_db = -10.0

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("initial_state")]
script = ExtResource("4_yw30f")
initial_state = NodePath("IdleState")
metadata/_custom_type_script = "uid://8dv7dce6ncjv"

[node name="IdleState" type="Node" parent="StateMachine"]
script = ExtResource("5_qjkh3")

[node name="MovingState" type="Node" parent="StateMachine"]
script = ExtResource("6_g6k8r")

[node name="ShootingBubbleState" type="Node" parent="StateMachine" node_paths=PackedStringArray("bubble_indicator")]
script = ExtResource("7_boad6")
bubble_indicator = NodePath("../../BubbleIndicator")

[node name="DashingState" type="Node" parent="StateMachine"]
script = ExtResource("8_8t03j")
dash_speed_increment = 5.0
stop_treshold = 20.0
speed_curve = SubResource("Curve_yllr7")

[node name="JumpingState" type="Node" parent="StateMachine" node_paths=PackedStringArray("floor_detection_component")]
script = ExtResource("12_32hag")
move_speed = 35.0
floor_detection_component = NodePath("../../FloorDetectionComponent")
sample_duration = 0.5
speed_curve = SubResource("Curve_e7oew")

[node name="JumpDurationTimer" type="Timer" parent="StateMachine/JumpingState"]
wait_time = 1.5
one_shot = true

[node name="StartJumpSound" type="AudioStreamPlayer" parent="StateMachine/JumpingState"]
stream = ExtResource("13_c35mf")

[node name="StopJumpSound" type="AudioStreamPlayer" parent="StateMachine/JumpingState"]
stream = ExtResource("14_65viv")

[node name="QuickDashingState" type="Node" parent="StateMachine" node_paths=PackedStringArray("floor_detection_component")]
script = ExtResource("13_tqiix")
distance_to_travel = 60.0
allow_jump_treshold = 30
floor_detection_component = NodePath("../../FloorDetectionComponent")

[node name="DashSound" type="AudioStreamPlayer" parent="StateMachine/QuickDashingState"]
stream = SubResource("AudioStreamRandomizer_e7oew")

[node name="OnAirCurrentState" type="Node" parent="StateMachine" node_paths=PackedStringArray("fall_detection_component")]
script = ExtResource("17_7pqkx")
fall_detection_component = NodePath("../../FloorDetectionComponent")

[node name="EmptyState" type="Node" parent="StateMachine"]
script = ExtResource("18_rptt4")

[node name="BubbleIndicator" parent="." instance=ExtResource("8_rgyib")]
visible = false
y_sort_enabled = true
position = Vector2(0, 4)
curve = SubResource("Curve2D_rgyib")
a = 10.0
b = 5.0

[node name="BetterInteractableManager" parent="." instance=ExtResource("14_kb6p2")]

[node name="BubbleSprite" type="Sprite2D" parent="."]
visible = false
z_index = 1
scale = Vector2(1e-05, 1e-05)
texture = ExtResource("15_wodsf")

[node name="DeadAnimPlayer" parent="." instance=ExtResource("22_bjvpn")]

[node name="ExplosionAbility" type="Node2D" parent="."]
script = ExtResource("22_s7qer")

[node name="ExplosionAreaVisual" parent="ExplosionAbility" instance=ExtResource("24_g4c7l")]

[node name="Hurtbox" parent="ExplosionAbility" instance=ExtResource("24_knn7v")]
collision_layer = 16
collision_mask = 16

[node name="CollisionShape2D" type="CollisionShape2D" parent="ExplosionAbility/Hurtbox"]
shape = SubResource("CircleShape2D_g4c7l")

[node name="VisualTimer" type="Timer" parent="ExplosionAbility"]
one_shot = true

[node name="AbilityTimer" type="Timer" parent="ExplosionAbility"]

[node name="ExplosionSound" type="AudioStreamPlayer" parent="ExplosionAbility"]
stream = ExtResource("25_knn7v")
volume_db = -10.0

[node name="FloorDetectionComponent" type="Node2D" parent="."]
script = ExtResource("26_uw77l")
coyote_time = 0.1

[node name="FloorDetector" parent="FloorDetectionComponent" instance=ExtResource("27_uw77l")]
collision_layer = 0
collision_mask = 96

[node name="CollisionShape2D" type="CollisionShape2D" parent="FloorDetectionComponent/FloorDetector"]
position = Vector2(0, 5.5)
shape = SubResource("RectangleShape2D_uw77l")
debug_color = Color(7.70092e-07, 0.6247227, 0.52935916, 0.41960785)

[node name="CoyoteTimeTimer" type="Timer" parent="FloorDetectionComponent"]

[node name="SafePointManager" type="Node" parent="." node_paths=PackedStringArray("floor_detector", "state_machine")]
script = ExtResource("26_7pqkx")
floor_detector = NodePath("../FloorDetectionComponent/FloorDetector")
state_machine = NodePath("../StateMachine")

[node name="RefreshPositionTimer" type="Timer" parent="SafePointManager"]

[node name="FollowTarget" type="Marker2D" parent="."]
position = Vector2(17, -11)

[node name="ItemFollowerManager" parent="." node_paths=PackedStringArray("follow_target") instance=ExtResource("27_rptt4")]
follow_target = NodePath("../FollowTarget")

[connection signal="timeout" from="StateMachine/JumpingState/JumpDurationTimer" to="StateMachine/JumpingState" method="_on_jump_duration_timer_timeout"]
[connection signal="player_fell" from="FloorDetectionComponent" to="." method="_on_floor_detection_component_player_fell"]
[connection signal="floor_status_changed" from="FloorDetectionComponent/FloorDetector" to="FloorDetectionComponent" method="_on_floor_detector_floor_status_changed"]
[connection signal="timeout" from="FloorDetectionComponent/CoyoteTimeTimer" to="FloorDetectionComponent" method="_on_coyote_time_timer_timeout"]
